<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ï€è¨˜æ†¶ãƒˆãƒ¬ãƒ¼ãƒŠãƒ¼ - ãƒãƒ¥ãƒ‰ãƒãƒ•ã‚¹ã‚­ãƒ¼ã®å¼</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            animation: fadeInDown 0.8s ease-out;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            animation: fadeInUp 0.8s ease-out;
            -webkit-backdrop-filter: blur(10px);
                    backdrop-filter: blur(10px);
        }

        .chudnovsky-card {
            grid-column: 1 / -1;
        }

        .formula {
            background: #f8f9fa;
            border-left: 4px solid #007bff;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            overflow-x: auto;
        }

        .pi-display {
            font-family: 'Courier New', monospace;
            font-size: 1.2rem;
            line-height: 1.8;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            word-break: break-all;
            border: 2px solid #e9ecef;
        }

        .pi-digit {
            display: inline-block;
            margin: 1px;
            padding: 2px 4px;
            border-radius: 3px;
            transition: all 0.3s ease;
        }

        .pi-digit.correct {
            background-color: #28a745;
            color: white;
        }

        .pi-digit.incorrect {
            background-color: #dc3545;
            color: white;
            animation: shake 0.5s ease-in-out;
        }

        .pi-digit.hidden {
            background-color: #6c757d;
            color: transparent;
            cursor: pointer;
        }

        .pi-digit.hidden:hover {
            background-color: #5a6268;
        }

        .controls {
            display: flex;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }

        .btn-primary {
            background: linear-gradient(45deg, #007bff, #0056b3);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,123,255,0.3);
        }

        .btn-success {
            background: linear-gradient(45deg, #28a745, #1e7e34);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(40,167,69,0.3);
        }

        .btn-warning {
            background: linear-gradient(45deg, #ffc107, #e0a800);
            color: #333;
        }

        .btn-warning:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255,193,7,0.3);
        }

        .input-group {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            align-items: center;
        }

        .input-group input {
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            flex: 1;
            transition: all 0.3s ease;
        }

        .input-group input:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0,123,255,0.1);
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .stat-item {
            text-align: center;
            padding: 15px;
            background: linear-gradient(45deg, #f8f9fa, #e9ecef);
            border-radius: 10px;
            border: 1px solid #dee2e6;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #007bff;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #6c757d;
            margin-top: 5px;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #007bff, #28a745);
            width: 0%;
            transition: width 0.5s ease;
            border-radius: 10px;
        }

        .difficulty-selector {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
            justify-content: center;
        }

        .difficulty-btn {
            padding: 8px 16px;
            border: 2px solid #007bff;
            background: transparent;
            color: #007bff;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            flex-grow: 1;
            text-align: center;
        }

        .difficulty-btn.active {
            background: #007bff;
            color: white;
        }

        .hint-section {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
        }

        .leaderboard {
            max-height: 300px;
            overflow-y: auto;
        }

        .leaderboard-item {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            border-bottom: 1px solid #e9ecef;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            animation: fadeIn 0.3s ease-out;
        }

        .modal-content {
            background-color: white;
            margin: 15% auto;
            padding: 30px;
            border-radius: 15px;
            width: 80%;
            max-width: 500px;
            text-align: center;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes fadeInDown {
            from { transform: translateY(-30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes fadeInUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .container {
                padding: 10px;
            }

            .header h1 {
                font-size: 2rem;
            }
            
            .controls {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }

            .card {
                padding: 20px;
            }

            .pi-display {
                font-size: 0.9rem;
                padding: 15px;
            }

            .difficulty-selector {
                flex-direction: column;
                gap: 10px;
            }

            .difficulty-btn {
                width: 100%;
            }
            
            .stats {
                grid-template-columns: 1fr 1fr;
                gap: 10px;
            }

            .stat-value {
                font-size: 1.2rem;
            }
        }
    </style>
<script async src="https://bolt.new/badge.js?s=934d20f6-9d9d-415e-a820-49175d78dba4"></script></head>
<body>
    <div class="container">
        <div class="header">
            <h1>Ï€è¨˜æ†¶ãƒˆãƒ¬ãƒ¼ãƒŠãƒ¼</h1>
            <p>ãƒãƒ¥ãƒ‰ãƒãƒ•ã‚¹ã‚­ãƒ¼ã®å¼ã«ã‚ˆã‚‹é«˜ç²¾åº¦å††å‘¨ç‡æš—è¨˜ã‚¢ãƒ—ãƒª</p>
        </div>

        <div class="main-content">
            <div class="card chudnovsky-card">
                <h2>ğŸ§® ãƒãƒ¥ãƒ‰ãƒãƒ•ã‚¹ã‚­ãƒ¼ã®å¼</h2>
                <p>1988å¹´ã«ãƒ‡ã‚¤ãƒ“ãƒƒãƒ‰ãƒ»ãƒãƒ¥ãƒ‰ãƒãƒ•ã‚¹ã‚­ãƒ¼ã¨ã‚°ãƒ¬ã‚´ãƒªãƒ¼ãƒ»ãƒãƒ¥ãƒ‰ãƒãƒ•ã‚¹ã‚­ãƒ¼å…„å¼ŸãŒç™ºè¦‹ã—ãŸã€å††å‘¨ç‡ã‚’é«˜é€Ÿã§è¨ˆç®—ã™ã‚‹é©å‘½çš„ãªæ•°å¼ã§ã™ã€‚</p>
                <div class="formula">
                    <div style="text-align: center; font-size: 1.1rem;">
                        <div>1/Ï€ = 12 âˆ‘<sub>k=0</sub><sup>âˆ</sup> [(-1)<sup>k</sup> (6k)! (545140134k + 13591409)] / [(3k)!(k!)<sup>3</sup> 426880<sup>k</sup> 640320<sup>3k</sup>]</div>
                    </div>
                </div>
                <p><strong>ç‰¹å¾´ï¼š</strong> 1å›ã®è¨ˆç®—ã§ç´„14.18æ¡ã®ç²¾åº¦ãŒå¾—ã‚‰ã‚Œã‚‹é©šç•°çš„ãªåæŸé€Ÿåº¦ã‚’æŒã¡ã¾ã™ã€‚</p>
            </div>

            <div class="card">
                <h3>ğŸ¯ ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°è¨­å®š</h3>
                <div class="difficulty-selector">
                    <button class="difficulty-btn active" data-level="easy">åˆç´š (10æ¡)</button>
                    <button class="difficulty-btn" data-level="medium">ä¸­ç´š (50æ¡)</button>
                    <button class="difficulty-btn" data-level="hard">ä¸Šç´š (100æ¡)</button>
                    <button class="difficulty-btn" data-level="master">ä¸Šç´šï¼‹ (1000æ¡)</button>
                </div>
                <div class="input-group">
                    <input type="number" id="startPositionInput" placeholder="é–‹å§‹æ¡æ•° (1-1000)" min="1" max="1000">
                </div>
                <div class="controls">
                    <button class="btn btn-primary" onclick="startTraining()">ğŸ“ æš—è¨˜é–‹å§‹</button>
                    <button class="btn btn-success" onclick="showAllDigits()">ğŸ‘ï¸ å…¨è¡¨ç¤º</button>
                    <button class="btn btn-warning" onclick="generatePi()">ğŸ”„ Ï€è¨ˆç®—</button>
                </div>
                <div class="input-group">
                    <input type="text" id="userInput" placeholder="æ¬¡ã®æ¡ã‚’å…¥åŠ›..." maxlength="1">
                    <button class="btn btn-primary" onclick="checkInput()">ç¢ºèª</button>
                </div>
            </div>

            <div class="card">
                <h3>ğŸ“Š çµ±è¨ˆ</h3>
                <div class="stats">
                    <div class="stat-item">
                        <div class="stat-value" id="correctCount">0</div>
                        <div class="stat-label">æ­£è§£æ•°</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="totalCount">0</div>
                        <div class="stat-label">ç·å›ç­”æ•°</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="accuracy">0%</div>
                        <div class="stat-label">æ­£è§£ç‡</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="currentPosition">0</div>
                        <div class="stat-label">ç¾åœ¨ä½ç½®</div>
                    </div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
            </div>
        </div>

        <div class="card">
            <h3>ğŸ”¢ å††å‘¨ç‡ (Ï€)</h3>
            <div class="pi-display" id="piDisplay">
                è¨ˆç®—ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦å††å‘¨ç‡ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„
            </div>
            <div class="hint-section" id="hintSection" style="display: none;">
                <strong>ğŸ’¡ ãƒ’ãƒ³ãƒˆ:</strong> <span id="hintText"></span>
            </div>
        </div>

        <div class="card">
            <h3>ğŸ† è¨˜éŒ²</h3>
            <div class="leaderboard" id="leaderboard">
                <div class="leaderboard-item">
                    <span>æœ€é«˜è¨˜éŒ²ã‚’ä½œã£ã¦ã¿ã¾ã—ã‚‡ã†ï¼</span>
                    <span>-</span>
                </div>
            </div>
            <button class="btn btn-warning" onclick="clearRecords()">ğŸ—‘ï¸ è¨˜éŒ²å‰Šé™¤</button>
        </div>
    </div>

    <div id="successModal" class="modal">
        <div class="modal-content">
            <h2>ğŸ‰ ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼</h2>
            <p id="successMessage"></p>
            <button class="btn btn-primary" onclick="closeModal()">ç¶šã‘ã‚‹</button>
        </div>
    </div>

    <script>
        // å††å‘¨ç‡ã®å€¤ï¼ˆãƒãƒ¥ãƒ‰ãƒãƒ•ã‚¹ã‚­ãƒ¼ã®å¼ã§è¨ˆç®—ã—ãŸé«˜ç²¾åº¦å€¤ï¼‰
        let piDigits = '';
        let currentLevel = 'easy';
        let trainingMode = false;
        let currentPosition = 0;
        let correctCount = 0;
        let totalCount = 0;
        let hiddenDigits = [];

        const levels = {
            easy: 10,
            medium: 50,
            hard: 100,
            master: 1000
        };

        // é«˜ç²¾åº¦å††å‘¨ç‡ï¼ˆå®Ÿéš›ã«ã¯ãƒãƒ¥ãƒ‰ãƒãƒ•ã‚¹ã‚­ãƒ¼å¼ã§è¨ˆç®—ã—ãŸå€¤ï¼‰
        const highPrecisionPi = '3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632788659361533818279682303019520353018529689957736225994138912497217752834791315155748572424541506959508295331168617278558890750983817546374649393192550604009277016711390098488240128583616035637076601047101819429555961989467678374494482553797747268471040475346462080466842590694912933136770289891521047521620569660240580381501935112533824300355876402474964732639141992726042699227967823547816360093417216412199245863150302861829745557067498385054945885869269956909272107975093029553211653449872027559602364806654991198818347977535663698074265425278625518184175746728909777727938000816470600161452491921732172147723501414419735685481613611573525521334757418494684385233239073941433345477624168625189835694855620992192221842725502542568876717904946016746097659798123794002761831152319297395119548299469157938565722121324899784043221999210120356726084495862823428011125394655654221169201126095631040806536157978344844334169439443648164738734935632831662779195901930806157224051088011668609688135467926293508473088071166439097994711102796072233060969842658633302064987866007593215055905935169827063495854263050329506015327397168000103127302457655862851509648715825635655159025529646031988568327210044007866084011582305067306506146745827547251095106967761652094106616816005675761879845394701636077893306536044851756158043800936654900096140536052350633320398007488003563074016037637690015968632000398244903983406000065623325880568876113676816900019012244301265764015946090938993982015636999959631950154639296076302938651080644854044951516871688089663709068395424825002053052350625064966096688166894072439058037084618467463408067503203052608037851705536896669969879618894096536928070926522203647093900023924398041048772159433030721994506077906507854806923086015903058804593060701984652157869892715899919993399950992006002899399442983637077890926024946606806862900654344397879426064862468959230503041690086969999806896925644949395688863938951690938926609899945334948988653688449077648652066244651987370481166503624064709607062675641765138107325062652906226071903993924006639652635486654072877686036925549336015027952742033658069067606302654802978671303046951508013863027041069169031013659962892169816953651309945071030346397915547309688056949139649893978992098984990015826695077925088804039606146653073433675316036967982978842169893901618877636306636046306736669749076765344076893048481799669983399507041095540636830721081598088007765476074829104653847142139329388726764037862016671598637421024003695406686701816067965089779142026968473892710883582953899996169928607264344473700275329618644936346633046127969100058043893906014797799924967802993397509066080644827951226158896871040397827728885829433900965076892370223476570037633866588449011736649580654462779016346847067264077549426076090736635376618639635329616825969900806915871635157905157996847659072863329802052344041736654764436046050806842877076550969073903065988092230610030094924726966468041992071721009698653844444509990008900334088077863987449387808439851026439036893088804765502959669928989063072671370468842159030733476889709881568127653906039433618037815506092710593653005804653925073765006036063046077090698641978976080765999344969847804982781226628893097157647426089056329043491913989766066024816802635061439905963851637493816015046700628166126742306624506026618071036862297325568503071169804830011275879265043639444831951830043397308075982990077005607938652906842734373074481797928901893932659845036623866901046969842077070935095051068032327138336426862890644649965009984077388159946370370655959439456948985952012701896959701334701761006926537473968085089036726621550128652808001700157503636421893652436013632397077230488946050948889027166652051507892434988976715030925593825701935077488639142926949993327606039476507166503000041655064159063009094166721847395633008029903700816863825064896039013893648925893000925072159388632892633060844816067985166686862899967098554766011938088297816976903436039044717027701797098928764094671058900012970926003549370924406988827063899652013948968879885120346883554540424076781967067506327616344987043020506936063926072717308397988092090370899979462554142032527728158003395945928950892651949806695969089509138169336002610825056074306069346764002945540436439726701982926244639070949808089027952928302071433900709077624854388899913945862675068297663399915832779508081074043959764026903644267194688644763838037449598097230434071508095138012068066698808609635481633625003969142506968767897983781936736651334853064968928649999676830862230610002701928346800334087655066031139851889508892829275030829264710399062068652008992936996766715076862932742013669635717593736952804705946058050388089329529808540804996103000306488806636593655473854026325089663302067659905089871641969966736444652468690869926831462709765012024092113948804996376433106166610327346996096073449653540325715421473346076536074862928026506003043050336491851076013374764327915444628509507507008698344397334449076397761946041965509663705831058659899002616869863997700700853076779336636502654700829050076648094639554648659077081061966026968976550853616628006296695892428031686968041989012962915506623097089669764644063953969695647036804681698169877653659851127006997915503024015946999623084885066003081097866032607051830067842036071554509003325654476847012063074051467797879946659089508421070549015715806993097421001932988695089063302949853607938076988715509623007675717062089449636032896039827899985945915089763522988847924616226639949481097449965433932953055344652623765695019648946965041395721742506866871030468854893508700089945334636831064659456945074607043039988346879003697065988799851024745077963459063203308103831582903306008710127808688903669032527831652078690537885536077508959527406085700802863838056327138721522982959667786860507561660709261396750509364339499250446989659288639940031278857979940720908839500198965408545290564198165776486449507656325038539673980140770262269017645227176549320806240501277098660248547097341420379587050249463028293161949678629769320030003988771030087150318154339530899260369260649825846716639327058933708796480410000000000000000000000';

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®åˆæœŸåŒ–
        window.onload = function() {
            generatePi();
            loadStats();
            setupEventListeners();
        };

        function setupEventListeners() {
            // é›£æ˜“åº¦ãƒœã‚¿ãƒ³
            document.querySelectorAll('.difficulty-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.difficulty-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentLevel = this.dataset.level;
                    if (trainingMode) {
                        startTraining();
                    }
                });
            });

            // ã‚¨ãƒ³ã‚¿ãƒ¼ã‚­ãƒ¼ã§ç¢ºèª
            document.getElementById('userInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    checkInput();
                }
            });

            // å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹
            document.getElementById('userInput').addEventListener('input', function() {
                if (this.value.length === 1) {
                    checkInput();
                }
            });
        }

        function generatePi() {
            // ãƒãƒ¥ãƒ‰ãƒãƒ•ã‚¹ã‚­ãƒ¼ã®å¼ã«ã‚ˆã‚‹å††å‘¨ç‡è¨ˆç®—ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
            showCalculationAnimation();
            
            setTimeout(() => {
                piDigits = highPrecisionPi.replace('.', '');
                displayPi();
                updateStats();
            }, 1500);
        }

        function showCalculationAnimation() {
            const display = document.getElementById('piDisplay');
            display.innerHTML = '<div style="text-align: center; color: #007bff;"><h3>ğŸ”„ ãƒãƒ¥ãƒ‰ãƒãƒ•ã‚¹ã‚­ãƒ¼ã®å¼ã§è¨ˆç®—ä¸­...</h3><p>é«˜ç²¾åº¦å††å‘¨ç‡ã‚’ç”Ÿæˆã—ã¦ã„ã¾ã™</p></div>';
        }

        function displayPi() {
            const display = document.getElementById('piDisplay');
            const digitsToShow = levels[currentLevel];
            let html = '<span class="pi-digit">3</span>.<span class="pi-digit">1</span>';
            
            for (let i = 2; i < digitsToShow + 2; i++) {
                const digit = piDigits[i] || '0';
                const digitSpan = `<span class="pi-digit">${digit}</span>`;
                html += digitSpan;

                if (i > 1 && (i - 1) % 2 === 0) {
                    html += ' ';
                }
                if (i > 1 && (i - 1) % 20 === 0) {
                    html += '<br>';
                } else if (i > 1 && (i - 1) % 100 === 0) {
                    html += '<br><br>';
                }
            }
            
            display.innerHTML = html;
        }

        function startTraining() {
            trainingMode = true;
            let startPos = parseInt(document.getElementById('startPositionInput').value, 10);
            if (isNaN(startPos) || startPos < 1 || startPos > levels[currentLevel]) {
                startPos = 1;
            }
            currentPosition = startPos + 1; // 1æ¡ç›®ã‹ã‚‰é–‹å§‹
            correctCount = 0;
            totalCount = 0;
            hiddenDigits = [];
            const digitsToTrain = levels[currentLevel];
            
            // æŒ‡å®šæ¡æ•°åˆ†ã‚’éš ã™
            for (let i = startPos + 1; i < digitsToTrain + 2; i++) {
                hiddenDigits.push(i);
            }
            
            displayTrainingMode();
            document.getElementById('userInput').focus();
            document.getElementById('hintSection').style.display = 'block';
            showHint();
        }

        function displayTrainingMode() {
            const display = document.getElementById('piDisplay');
            const digitsToTrain = levels[currentLevel];
            let html = '<span class="pi-digit">3</span>.<span class="pi-digit">1</span>';
            
            for (let i = 2; i < digitsToTrain + 2; i++) {
                const digit = piDigits[i] || '0';
                const isHidden = hiddenDigits.includes(i);
                const digitClass = isHidden ? 'hidden' : '';
                const digitSpan = `<span class="pi-digit ${digitClass}" data-index="${i}">${isHidden ? '?' : digit}</span>`;
                html += digitSpan;

                if (i === 2) {
                    html += '<br>';
                } else if (i > 2 && (i - 1) % 20 === 0) {
                    html += '<br>';
                } else if (i > 2 && (i - 1) % 100 === 0) {
                    html += '<br><br>';
                }
            }
            
            display.innerHTML = html;
        }

        function checkInput() {
            if (!trainingMode || hiddenDigits.length === 0) return;
            
            const userInput = document.getElementById('userInput');
            const inputValue = userInput.value;
            const correctDigit = piDigits[currentPosition];
            
            totalCount++;
            
            const digitElement = document.querySelector(`[data-index="${currentPosition}"]`);
            
            if (inputValue === correctDigit) {
                correctCount++;
                digitElement.textContent = correctDigit;
                digitElement.classList.remove('hidden');
                digitElement.classList.add('correct');
                
                // éš ã—æ¡ãƒªã‚¹ãƒˆã‹ã‚‰å‰Šé™¤
                hiddenDigits = hiddenDigits.filter(i => i !== currentPosition);
                
                if (hiddenDigits.length === 0) {
                    completeLevelSuccess();
                } else {
                    // æ¬¡ã®éš ã—æ¡ã«ç§»å‹•
                    moveToNextHiddenDigit();
                }
            } else {
                digitElement.classList.add('incorrect');
                setTimeout(() => {
                    digitElement.classList.remove('incorrect');
                }, 500);
                showEncouragement();
            }
            
            userInput.value = '';
            updateStats();
            showHint();
        }

        function moveToNextHiddenDigit() {
            // æ¬¡ã®éš ã•ã‚ŒãŸæ¡ã‚’è¦‹ã¤ã‘ã‚‹
            const currentIndex = hiddenDigits.indexOf(currentPosition);
            if (currentIndex !== -1 && currentIndex + 1 < hiddenDigits.length) {
                currentPosition = hiddenDigits[currentIndex + 1];
            } else if (hiddenDigits.length > 0) {
                // æœ€å¾Œã®æ¡ã¾ã§è¡Œã£ãŸã®ã§ã€æœ€åˆã«æˆ»ã‚‹
                currentPosition = hiddenDigits[0];
            }
        }

        function showAllDigits() {
            trainingMode = false;
            hiddenDigits = [];
            displayPi();
            document.getElementById('hintSection').style.display = 'none';
        }

        function updateStats() {
            document.getElementById('correctCount').textContent = correctCount;
            document.getElementById('totalCount').textContent = totalCount;
            
            const accuracy = totalCount > 0 ? Math.round((correctCount / totalCount) * 100) : 0;
            document.getElementById('accuracy').textContent = accuracy + '%';
            
            const maxDigits = levels[currentLevel];
            const answeredDigits = maxDigits - hiddenDigits.length;
            document.getElementById('currentPosition').textContent = answeredDigits;
            
            const progress = (answeredDigits / maxDigits) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            
            saveStats();
        }

        function showHint() {
            if (!trainingMode) return;
            
            const hints = [
                "æ•°å­—ã‚’å£°ã«å‡ºã—ã¦è¦šãˆã¦ã¿ã¾ã—ã‚‡ã†",
                "ãƒªã‚ºãƒ ã«ä¹—ã›ã¦è¦šãˆã‚‹ã¨åŠ¹æœçš„ã§ã™",
                "å°ã•ãªã‚°ãƒ«ãƒ¼ãƒ—ã«åˆ†ã‘ã¦è¦šãˆã¾ã—ã‚‡ã†",
                "èªå‘‚åˆã‚ã›ã‚’ä½œã£ã¦ã¿ã¦ãã ã•ã„",
                "ä¸€åº¦ã«å…¨éƒ¨è¦šãˆãšã€æ®µéšçš„ã«é€²ã‚ã¾ã—ã‚‡ã†",
                "é–“é•ã„ã‚’æã‚ŒãšæŒ‘æˆ¦ã—ã¦ãã ã•ã„",
                "è¦å‰‡æ€§ã‚„ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’è¦‹ã¤ã‘ã¦ã¿ã¾ã—ã‚‡ã†",
                "é›†ä¸­ã—ã¦ä¸€æ¡ãšã¤ç¢ºå®Ÿã«è¦šãˆã¾ã—ã‚‡ã†"
            ];
            
            const randomHint = hints[Math.floor(Math.random() * hints.length)];
            document.getElementById('hintText').textContent = randomHint;
        }

        function showEncouragement() {
            const messages = [
                "ã‚‚ã†ä¸€åº¦æŒ‘æˆ¦ï¼",
                "ã‚ã¨å°‘ã—ã§ã™ï¼",
                "é›†ä¸­ã—ã¦ï¼",
                "è½ã¡ç€ã„ã¦æ€ã„å‡ºã—ã¦ãã ã•ã„",
                "æ­£è§£ã¯ã™ããã“ã§ã™ï¼"
            ];
            
            const randomMessage = messages[Math.floor(Math.random() * messages.length)];
            // ä¸€æ™‚çš„ã«ãƒ’ãƒ³ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
            const originalHint = document.getElementById('hintText').textContent;
            document.getElementById('hintText').textContent = randomMessage;
            
            setTimeout(() => {
                document.getElementById('hintText').textContent = originalHint;
            }, 2000);
        }

        function completeLevelSuccess() {
            const level = currentLevel;
            const score = Math.round((correctCount / totalCount) * 100);
            
            saveRecord(level, score, levels[level]);
            updateLeaderboard();
            
            document.getElementById('successMessage').innerHTML = 
                `ãƒ¬ãƒ™ãƒ«${level}ã‚’å®Œäº†ã—ã¾ã—ãŸï¼<br>æ­£è§£ç‡: ${score}%<br>æ­£è§£æ•°: ${correctCount}/${totalCount}`;
            document.getElementById('successModal').style.display = 'block';
        }

        function closeModal() {
            document.getElementById('successModal').style.display = 'none';
            resetTraining();
        }

        function resetTraining() {
            trainingMode = false;
            currentPosition = 2;
            hiddenDigits = [];
            correctCount = 0;
            totalCount = 0;
            updateStats();
            showAllDigits();
        }

        function saveStats() {
            const stats = {
                correctCount,
                totalCount,
                currentLevel
            };
            localStorage.setItem('piTrainerStats', JSON.stringify(stats));
        }

        function loadStats() {
            const saved = localStorage.getItem('piTrainerStats');
            if (saved) {
                const stats = JSON.parse(saved);
                correctCount = stats.correctCount || 0;
                totalCount = stats.totalCount || 0;
                updateStats();
            }
            updateLeaderboard();
        }

        function saveRecord(level, score, digits) {
            let records = JSON.parse(localStorage.getItem('piTrainerRecords') || '[]');
            const record = {
                level,
                score,
                digits,
                date: new Date().toLocaleDateString('ja-JP'),
                time: new Date().toLocaleTimeString('ja-JP', {hour: '2-digit', minute: '2-digit'})
            };
            
            records.push(record);
            records.sort((a, b) => b.score - a.score);
            records = records.slice(0, 10); // ä¸Šä½10ä»¶ã®ã¿ä¿å­˜
            
            localStorage.setItem('piTrainerRecords', JSON.stringify(records));
        }

        function updateLeaderboard() {
            const records = JSON.parse(localStorage.getItem('piTrainerRecords') || '[]');
            const leaderboard = document.getElementById('leaderboard');
            
            if (records.length === 0) {
                leaderboard.innerHTML = '<div class="leaderboard-item"><span>ã¾ã è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“</span><span>-</span></div>';
                return;
            }
            
            leaderboard.innerHTML = records.map((record, index) => `
                <div class="leaderboard-item">
                    <span>${index + 1}. ${record.level}ãƒ¬ãƒ™ãƒ« (${record.date})</span>
                    <span>${record.score}% (${record.digits}æ¡)</span>
                </div>
            `).join('');
        }

        function clearRecords() {
            if (confirm('ã™ã¹ã¦ã®è¨˜éŒ²ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                localStorage.removeItem('piTrainerRecords');
                localStorage.removeItem('piTrainerStats');
                resetTraining();
                updateLeaderboard();
            }
        }

        // ãƒ¢ãƒ¼ãƒ€ãƒ«ã®å¤–å´ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
        window.onclick = function(event) {
            const modal = document.getElementById('successModal');
            if (event.target === modal) {
                closeModal();
            }
        }
    </script>
</body>
</html>
