<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <!-- ズームによる誤作動防止 -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>円周率暗記ゲーム</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      padding: 20px;
      background-color: #f9f9f9;
      -webkit-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }
    #gameContainer {
      max-width: 500px;
      margin: 0 auto;
      padding: 15px;
      background-color: #fff;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    h1 {
      margin-bottom: 10px;
    }
    /* 入力済みの数字表示エリア（20桁ごとに改行） */
    #piDisplay {
      font-size: 14px; 
      letter-spacing: 1px;
      margin: 10px 0;
      min-height: 100px;
      word-break: break-all;
      white-space: pre-wrap;
      line-height: 1;
    }
    .digit {
      font-size: 14px;
    }
    .wrong {
      color: red;
    }
    /* 電卓型配置と大きなボタン */
    #keypad {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      max-width: 320px;
      margin: 20px auto;
    }
    #keypad button {
      padding: 25px;
      font-size: 24px;
      cursor: pointer;
      border: none;
      border-radius: 4px;
      background-color: #0078d4;
      color: #fff;
    }
    #keypad button:hover {
      background-color: #005a9e;
    }
    #message {
      margin: 10px;
      font-size: 16px;
      min-height: 24px;
    }
    #timerDiv {
      font-size: 20px;
      margin: 10px;
    }
    .config {
      margin: 10px 0;
    }
    /* スタート、終了などのコントロールボタン */
    #controlButtons {
      margin: 10px 0;
    }
    #controlButtons button {
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      border: none;
      border-radius: 4px;
      background-color: #0078d4;
      color: #fff;
      margin: 0 5px;
    }
    #controlButtons button:hover {
      background-color: #005a9e;
    }
  </style>
</head>
<body>
  <div id="gameContainer">
    <h1>円周率暗記ゲーム</h1>
    <div class="config">
      <label for="startIndex">開始桁数:</label>
      <input type="number" id="startIndex" value="0" min="0">
    </div>
    <div class="config">
      <label for="targetDigits">目標桁数 (最大500):</label>
      <input type="number" id="targetDigits" value="500" min="1" max="500">
    </div>
    <div class="config">
      <input type="radio" id="modeStandard" name="mode" value="standard" checked>
      <label for="modeStandard">標準モード</label>
      &nbsp;&nbsp;
      <input type="radio" id="modeTimeAttack" name="mode" value="timeAttack">
      <label for="modeTimeAttack">タイムアタックモード</label>
    </div>
    <div id="controlButtons" class="config">
      <button id="startBtn">スタート</button>
      <button id="exitBtn">終了</button>
    </div>
    <div id="timerDiv" style="display:none;">タイム: 0秒</div>
    <!-- 入力済みの数字の表示（20桁ごとに改行） -->
    <div id="piDisplay"></div>
    <div id="message"></div>
    <!-- 電卓型キーパッド（上から7,8,9 / 4,5,6 / 1,2,3 / 0,．,C） -->
    <div id="keypad">
      <button class="key">7</button>
      <button class="key">8</button>
      <button class="key">9</button>
      <button class="key">4</button>
      <button class="key">5</button>
      <button class="key">6</button>
      <button class="key">1</button>
      <button class="key">2</button>
      <button class="key">3</button>
      <button class="key">0</button>
      <button class="key">.</button>
      <button class="key" id="clearButton">C</button>
    </div>
  </div>
  
  <script>
    // ダブルクリックによるズーム防止
    document.addEventListener('dblclick', function(e) {
      e.preventDefault();
    }, { passive: false });
    
    document.addEventListener("DOMContentLoaded", function() {
      // πの桁（小数点含む、約500桁以上）
      const pi =
        "3.14159265358979323846264338327950288419716939937510" +
        "58209749445923078164062862089986280348253421170679" +
        "82148086513282306647093844609550582231725359408128" +
        "48111745028410270193852110555964462294895493038196" +
        "44288109756659334461284756482337867831652712019091" +
        "45648566923460348610454326648213393607260249141273" +
        "72458700660631558817488152092096282925409171536436" +
        "78925903600113305305488204665213841469519415116094" +
        "33057270365759591953092186117381932611793105118548";
      
      let targetCount = 0;       // 入力する桁数（目標桁数）
      let startIndex = 0;        // ゲーム開始時のpiのインデックス
      let currentIndex = 0;      // 現在のpiの位置
      let digitsHistory = [];    // 各桁の入力履歴（正誤の情報付き）
      let gameMode = "standard";
      let timerInterval = null;
      let startTime = null;
      let gameActive = false;
      
      // 各種要素の取得
      const startIndexInput = document.getElementById("startIndex");
      const targetDigitsInput = document.getElementById("targetDigits");
      const modeStandardRadio = document.getElementById("modeStandard");
      const modeTimeAttackRadio = document.getElementById("modeTimeAttack");
      const startBtn = document.getElementById("startBtn");
      const exitBtn = document.getElementById("exitBtn");
      const piDisplay = document.getElementById("piDisplay");
      const messageDiv = document.getElementById("message");
      const keypadButtons = document.querySelectorAll(".key");
      const timerDiv = document.getElementById("timerDiv");
      
      // ゲームの初期化
      function initGame() {
        // 入力値の取得と補正
        startIndex = parseInt(startIndexInput.value, 10);
        if (isNaN(startIndex) || startIndex < 0) {
          startIndex = 0;
          startIndexInput.value = 0;
        }
        targetCount = parseInt(targetDigitsInput.value, 10);
        if (isNaN(targetCount) || targetCount < 1) {
          targetCount = 500;
          targetDigitsInput.value = 500;
        }
        // pi の残り桁数を超えないように補正
        if (startIndex + targetCount > pi.length) {
          targetCount = pi.length - startIndex;
          targetDigitsInput.value = targetCount;
        }
        currentIndex = startIndex;
        digitsHistory = [];
        piDisplay.innerHTML = "";
        messageDiv.textContent = "";
        gameActive = true;
        
        if (modeTimeAttackRadio.checked) {
          gameMode = "timeAttack";
          timerDiv.style.display = "block";
          startTimer();
        } else {
          gameMode = "standard";
          timerDiv.style.display = "none";
          stopTimer();
        }
      }
      
      // タイマー開始
      function startTimer() {
        startTime = Date.now();
        timerDiv.textContent = "タイム: 0秒";
        timerInterval = setInterval(() => {
          const elapsed = Math.floor((Date.now() - startTime) / 1000);
          timerDiv.textContent = "タイム: " + elapsed + "秒";
        }, 500);
      }
      
      // タイマー停止
      function stopTimer() {
        if (timerInterval) {
          clearInterval(timerInterval);
          timerInterval = null;
        }
      }
      
      // 入力済みの数字を20桁ごとに改行して表示
      function updateDisplay() {
        let lines = [];
        for (let i = 0; i < digitsHistory.length; i += 20) {
          let line = digitsHistory.slice(i, i + 20).map(item => {
            return item.wrong
              ? `<span class="digit wrong">${item.digit}</span>`
              : `<span class="digit">${item.digit}</span>`;
          }).join("");
          lines.push(line);
        }
        piDisplay.innerHTML = lines.join("<br>");
      }
      
      // キー入力の処理
      function handleKeyInput(value) {
        if (!gameActive) return;
        
        if (value === "C") {
          if (currentIndex > startIndex) {
            currentIndex--;
            digitsHistory.pop();
            updateDisplay();
            messageDiv.textContent = "";
          }
          return;
        }
        
        // 入力可能な桁数の範囲内で処理
        if (currentIndex < startIndex + targetCount) {
          const expected = pi.charAt(currentIndex);
          if (value === expected) {
            digitsHistory.push({ digit: expected, wrong: false });
            messageDiv.textContent = "正解！ 現在 " + (currentIndex - startIndex + 1) + " 桁";
          } else {
            digitsHistory.push({ digit: expected, wrong: true });
            messageDiv.textContent = "間違い！ 正解は '" + expected + "' です";
          }
          currentIndex++;
          updateDisplay();
          
          if (currentIndex === startIndex + targetCount) {
            messageDiv.textContent += "（目標桁数に達しました）";
            gameActive = false;
            stopTimer();
          }
        }
      }
      
      keypadButtons.forEach(btn => {
        btn.addEventListener("click", function() {
          handleKeyInput(this.textContent);
        });
      });
      
      startBtn.addEventListener("click", function() {
        stopTimer();
        initGame();
      });
      
      exitBtn.addEventListener("click", function() {
        gameActive = false;
        stopTimer();
        messageDiv.textContent = "ゲーム終了";
      });
    });
  </script>
</body>
</html>