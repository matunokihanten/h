<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ£’ç§»å‹•ãƒ‘ã‚ºãƒ«ã‚²ãƒ¼ãƒ </title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }

        .game-container {
            max-width: 1000px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .game-info {
            display: flex;
            justify-content: space-around;
            margin-bottom: 30px;
            font-size: 1.2em;
            background: rgba(255, 255, 255, 0.2);
            padding: 15px;
            border-radius: 10px;
        }

        .game-board {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 30px;
            margin: 40px 0;
            min-height: 200px;
        }

        .digit-container {
            position: relative;
            width: 80px;
            height: 120px;
        }

        .operator-container {
            position: relative;
            width: 60px;
            height: 120px;
        }

        .stick {
            position: absolute;
            background: #ffd700;
            border: 2px solid #ffed4e;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
        }

        .stick:hover {
            background: #ffed4e;
            transform: scale(1.05);
        }

        .stick.dragging {
            opacity: 0.6;
            z-index: 1000;
            transform: scale(1.1);
        }

        .empty-slot {
            position: absolute;
            background: rgba(255, 255, 255, 0.1);
            border: 2px dashed rgba(255, 255, 255, 0.3);
            border-radius: 4px;
        }

        .horizontal {
            width: 50px;
            height: 8px;
        }

        .vertical {
            width: 8px;
            height: 50px;
        }

        .controls {
            text-align: center;
            margin-top: 30px;
        }

        button {
            background: linear-gradient(45deg, #ff6b6b, #ff8e8e);
            color: white;
            border: none;
            padding: 12px 24px;
            margin: 0 10px;
            border-radius: 25px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        button:disabled {
            background: #666;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .message {
            text-align: center;
            margin: 20px 0;
            font-size: 1.3em;
            font-weight: bold;
            min-height: 30px;
        }

        .success {
            color: #4CAF50;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .error {
            color: #ff6b6b;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .hint {
            background: rgba(255, 255, 255, 0.2);
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            font-size: 1.1em;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="header">
            <h1>ğŸ§© æ£’ç§»å‹•ãƒ‘ã‚ºãƒ«ã‚²ãƒ¼ãƒ </h1>
            <p>æ£’ã‚’å‹•ã‹ã—ã¦æ­£ã—ã„æ•°å¼ã‚’ä½œã‚ã†ï¼</p>
        </div>

        <div class="game-info">
            <div>ãƒ¬ãƒ™ãƒ«: <span id="level">1</span></div>
            <div>ç§»å‹•å¯èƒ½: <span id="moves-left">1</span>æœ¬</div>
            <div>ã‚¹ã‚³ã‚¢: <span id="score">0</span></div>
        </div>

        <div class="game-board" id="game-board">
            <!-- ã‚²ãƒ¼ãƒ ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŒã“ã“ã«å‹•çš„ã«ç”Ÿæˆã•ã‚Œã¾ã™ -->
        </div>

        <div class="message" id="message"></div>

        <div class="controls">
            <button onclick="resetLevel()">ãƒªã‚»ãƒƒãƒˆ</button>
            <button id="next-btn" onclick="nextLevel()" disabled>æ¬¡ã®ãƒ¬ãƒ™ãƒ«</button>
            <button onclick="showHint()">ãƒ’ãƒ³ãƒˆ</button>
        </div>

        <div id="hint" class="hint" style="display: none;"></div>
    </div>

    <script>
        // ã‚²ãƒ¼ãƒ çŠ¶æ…‹
        let currentLevel = 1;
        let score = 0;
        let movesLeft = 0;
        let draggedStick = null;
        let dragOffset = { x: 0, y: 0 };

        // ãƒ¬ãƒ™ãƒ«å®šç¾©
        const levels = [
            { equation: "1+1=3", moves: 1, hint: "å³ã®æ•°å­—ã€Œ3ã€ã‚’ã€Œ2ã€ã«å¤‰ãˆã‚‹ãŸã‚ã€3ã®å³ä¸‹ã®æ£’ã‚’å–ã‚Šé™¤ãã¾ã—ã‚‡ã†ã€‚" },
            { equation: "2-1=2", moves: 1, hint: "ã€Œ-ã€ã‚’ã€Œ+ã€ã«å¤‰ãˆã‚‹ãŸã‚ã€ç¸¦ã®æ£’ã‚’æ¨ªã«ç§»å‹•ã—ã¾ã—ã‚‡ã†ã€‚" },
            { equation: "3+3=8", moves: 1, hint: "å³ã®ã€Œ8ã€ã‚’ã€Œ6ã€ã«å¤‰ãˆã‚‹ãŸã‚ã€8ã®å³ä¸Šã®ç¸¦æ£’ã‚’å–ã‚Šé™¤ãã¾ã—ã‚‡ã†ã€‚" },
            { equation: "6-4=3", moves: 1, hint: "å³ã®ã€Œ3ã€ã‚’ã€Œ2ã€ã«å¤‰ãˆã‚‹ãŸã‚ã€3ã®å³ä¸‹ã®æ£’ã‚’å–ã‚Šé™¤ãã¾ã—ã‚‡ã†ã€‚" },
            { equation: "8+1=6", moves: 2, hint: "ã€Œ8ã€ã‚’ã€Œ5ã€ã«å¤‰ãˆã€ã€Œ6ã€ã‚’ã€Œ9ã€ã«å¤‰ãˆã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚" },
            { equation: "5+5=9", moves: 1, hint: "å³ã®ã€Œ9ã€ã‚’ã€Œ10ã€ã«å¤‰ãˆã‚‹ãŸã‚ã€æ£’ã‚’ç§»å‹•ã•ã›ã¾ã—ã‚‡ã†ã€‚" },
            { equation: "7-2=6", moves: 1, hint: "ã€Œ7ã€ã‚’ã€Œ9ã€ã«å¤‰ãˆã‚‹ãŸã‚ã€æ£’ã‚’è¿½åŠ ã—ã¾ã—ã‚‡ã†ã€‚" },
            { equation: "4+4=7", moves: 1, hint: "å³ã®ã€Œ7ã€ã‚’ã€Œ8ã€ã«å¤‰ãˆã‚‹ãŸã‚ã€æ£’ã‚’è¿½åŠ ã—ã¾ã—ã‚‡ã†ã€‚" }
        ];

        // 7ã‚»ã‚°ãƒ¡ãƒ³ãƒˆæ•°å­—ã®å®šç¾©
        const digitPatterns = {
            '0': [1, 1, 1, 1, 1, 1, 0], // ä¸Šã€å³ä¸Šã€å³ä¸‹ã€ä¸‹ã€å·¦ä¸‹ã€å·¦ä¸Šã€ä¸­å¤®
            '1': [0, 1, 1, 0, 0, 0, 0],
            '2': [1, 1, 0, 1, 1, 0, 1],
            '3': [1, 1, 1, 1, 0, 0, 1],
            '4': [0, 1, 1, 0, 0, 1, 1],
            '5': [1, 0, 1, 1, 0, 1, 1],
            '6': [1, 0, 1, 1, 1, 1, 1],
            '7': [1, 1, 1, 0, 0, 0, 0],
            '8': [1, 1, 1, 1, 1, 1, 1],
            '9': [1, 1, 1, 1, 0, 1, 1]
        };

        // æ£’ã®ä½ç½®å®šç¾©
        const stickPositions = [
            { x: 15, y: 0, class: 'horizontal' },   // ä¸Š
            { x: 60, y: 15, class: 'vertical' },    // å³ä¸Š
            { x: 60, y: 55, class: 'vertical' },    // å³ä¸‹
            { x: 15, y: 100, class: 'horizontal' }, // ä¸‹
            { x: 0, y: 55, class: 'vertical' },     // å·¦ä¸‹
            { x: 0, y: 15, class: 'vertical' },     // å·¦ä¸Š
            { x: 15, y: 50, class: 'horizontal' }   // ä¸­å¤®
        ];

        // æ¼”ç®—å­ã®å®šç¾©
        const operatorPatterns = {
            '+': [[20, 35, 'horizontal'], [25, 20, 'vertical']],
            '-': [[20, 50, 'horizontal']],
            '=': [[15, 40, 'horizontal'], [15, 60, 'horizontal']]
        };

        function initGame() {
            loadLevel(currentLevel);
        }

        function loadLevel(level) {
            const levelData = levels[level - 1];
            if (!levelData) {
                showMessage("ğŸ‰ å…¨ãƒ¬ãƒ™ãƒ«ã‚¯ãƒªã‚¢ï¼ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼", "success");
                return;
            }

            movesLeft = levelData.moves;
            updateDisplay();
            createGameBoard(levelData.equation);
            showMessage("");
            document.getElementById('next-btn').disabled = true;
        }

        function createGameBoard(equation) {
            const board = document.getElementById('game-board');
            board.innerHTML = '';

            for (let i = 0; i < equation.length; i++) {
                const char = equation[i];
                if (char >= '0' && char <= '9') {
                    board.appendChild(createDigit(char, i));
                } else if (char === '+' || char === '-' || char === '=') {
                    board.appendChild(createOperator(char, i));
                }
            }
        }

        function createDigit(digit, index) {
            const container = document.createElement('div');
            container.className = 'digit-container';
            container.dataset.index = index;

            const pattern = digitPatterns[digit];
            
            // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªæ£’ã‚’ä½œæˆ
            pattern.forEach((active, stickIndex) => {
                if (active) {
                    const stick = createStick(stickPositions[stickIndex], `${index}-${stickIndex}`, true);
                    container.appendChild(stick);
                }
            });

            // ç©ºã®ã‚¹ãƒ­ãƒƒãƒˆã‚’ä½œæˆ
            stickPositions.forEach((pos, stickIndex) => {
                if (!pattern[stickIndex]) {
                    const slot = createEmptySlot(pos, `${index}-${stickIndex}`);
                    container.appendChild(slot);
                }
            });

            return container;
        }

        function createOperator(operator, index) {
            const container = document.createElement('div');
            container.className = 'operator-container';
            container.dataset.index = index;

            const pattern = operatorPatterns[operator];
            
            pattern.forEach((pos, stickIndex) => {
                const stick = document.createElement('div');
                stick.className = `stick ${pos[2]}`;
                stick.style.left = pos[0] + 'px';
                stick.style.top = pos[1] + 'px';
                stick.dataset.id = `${index}-${stickIndex}`;
                stick.dataset.active = 'true';
                addStickEvents(stick);
                container.appendChild(stick);
            });

            return container;
        }

        function createStick(position, id, active) {
            const stick = document.createElement('div');
            stick.className = `stick ${position.class}`;
            stick.style.left = position.x + 'px';
            stick.style.top = position.y + 'px';
            stick.dataset.id = id;
            stick.dataset.active = active;
            
            if (active) {
                addStickEvents(stick);
            }
            
            return stick;
        }

        function createEmptySlot(position, id) {
            const slot = document.createElement('div');
            slot.className = `empty-slot ${position.class}`;
            slot.style.left = position.x + 'px';
            slot.style.top = position.y + 'px';
            slot.dataset.id = id;
            
            slot.addEventListener('dragover', handleDragOver);
            slot.addEventListener('drop', handleDrop);
            
            return slot;
        }

        function addStickEvents(stick) {
            stick.draggable = true;
            stick.addEventListener('dragstart', handleDragStart);
            stick.addEventListener('dragend', handleDragEnd);
        }

        function handleDragStart(e) {
            if (movesLeft <= 0) {
                e.preventDefault();
                return;
            }
            
            draggedStick = e.target;
            e.target.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
        }

        function handleDragEnd(e) {
            e.target.classList.remove('dragging');
            draggedStick = null;
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
        }

        function handleDrop(e) {
            e.preventDefault();
            
            if (!draggedStick || movesLeft <= 0) return;

            const targetSlot = e.target.closest('.empty-slot');
            if (!targetSlot) return;

            // æ£’ã‚’ç§»å‹•
            const sourceContainer = draggedStick.parentNode;
            const targetContainer = targetSlot.parentNode;

            // å…ƒã®ä½ç½®ã«ç©ºã‚¹ãƒ­ãƒƒãƒˆã‚’ä½œæˆ
            const sourcePos = {
                x: parseInt(draggedStick.style.left),
                y: parseInt(draggedStick.style.top)
            };
            const sourceSlot = createEmptySlot(sourcePos, draggedStick.dataset.id);
            sourceContainer.appendChild(sourceSlot);

            // æ£’ã‚’æ–°ã—ã„ä½ç½®ã«ç§»å‹•
            draggedStick.style.left = targetSlot.style.left;
            draggedStick.style.top = targetSlot.style.top;
            draggedStick.dataset.id = targetSlot.dataset.id;
            
            targetContainer.appendChild(draggedStick);
            targetSlot.remove();

            movesLeft--;
            updateDisplay();

            if (movesLeft === 0) {
                setTimeout(checkSolution, 100);
            }
        }

        function checkSolution() {
            const equation = getCurrentEquation();
            
            try {
                // ç­‰å·ã§åˆ†å‰²
                const parts = equation.split('=');
                if (parts.length !== 2) {
                    showFailure();
                    return;
                }

                const leftSide = parts[0].trim();
                const rightSide = parseInt(parts[1].trim());

                // å·¦è¾ºã‚’è©•ä¾¡
                const leftResult = eval(leftSide);
                
                if (leftResult === rightSide) {
                    showSuccess();
                } else {
                    showFailure();
                }
            } catch (error) {
                showFailure();
            }
        }

        function getCurrentEquation() {
            const containers = document.querySelectorAll('.digit-container, .operator-container');
            let equation = '';

            containers.forEach(container => {
                const index = parseInt(container.dataset.index);
                
                if (container.classList.contains('digit-container')) {
                    equation += getDigitFromContainer(container);
                } else {
                    equation += getOperatorFromContainer(container);
                }
            });

            return equation;
        }

        function getDigitFromContainer(container) {
            const activeSticks = Array.from(container.querySelectorAll('.stick')).map(stick => {
                const id = stick.dataset.id.split('-')[1];
                return parseInt(id);
            });

            // ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°
            for (let digit in digitPatterns) {
                const pattern = digitPatterns[digit];
                let matches = true;
                
                for (let i = 0; i < 7; i++) {
                    const shouldBeActive = pattern[i] === 1;
                    const isActive = activeSticks.includes(i);
                    
                    if (shouldBeActive !== isActive) {
                        matches = false;
                        break;
                    }
                }
                
                if (matches) {
                    return digit;
                }
            }
            
            return '?'; // ä¸æ˜ãªæ•°å­—
        }

        function getOperatorFromContainer(container) {
            const sticks = container.querySelectorAll('.stick');
            
            if (sticks.length === 1) {
                return '-';
            } else if (sticks.length === 2) {
                // + ã‹ = ã‹ã‚’åˆ¤å®š
                let hasVertical = false;
                sticks.forEach(stick => {
                    if (stick.classList.contains('vertical')) {
                        hasVertical = true;
                    }
                });
                return hasVertical ? '+' : '=';
            }
            
            return '?';
        }

        function showSuccess() {
            score += currentLevel * 100;
            showMessage("ğŸ‰ æ­£è§£ï¼ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼", "success");
            document.getElementById('next-btn').disabled = false;
            updateDisplay();
        }

        function showFailure() {
            showMessage("å¤±æ•—ï¼ãƒªã‚»ãƒƒãƒˆã—ã¦å†æŒ‘æˆ¦ã—ã¾ã—ã‚‡ã†ã€‚", "error");
        }

        function showMessage(text, className = "") {
            const messageElement = document.getElementById('message');
            messageElement.textContent = text;
            messageElement.className = `message ${className}`;
        }

        function updateDisplay() {
            document.getElementById('level').textContent = currentLevel;
            document.getElementById('moves-left').textContent = movesLeft;
            document.getElementById('score').textContent = score;
        }

        function resetLevel() {
            loadLevel(currentLevel);
            document.getElementById('hint').style.display = 'none';
        }

        function nextLevel() {
            currentLevel++;
            loadLevel(currentLevel);
            document.getElementById('hint').style.display = 'none';
        }

        function showHint() {
            const levelData = levels[currentLevel - 1];
            if (levelData) {
                const hintElement = document.getElementById('hint');
                hintElement.textContent = `ğŸ’¡ ãƒ’ãƒ³ãƒˆ: ${levelData.hint}`;
                hintElement.style.display = 'block';
            }
        }

        // ã‚²ãƒ¼ãƒ é–‹å§‹
        initGame();
    </script>
</body>
</html>